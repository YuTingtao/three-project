import{S as f,A as p,D as h,P as u,W as g,O as w,R,E as d,T as v,a as l,G as S,F as b,b as z,B as L,V as c,M as U}from"./three-Dmt5tGih.js";import{g as x,f as m,h as C,w as n,j,o as M}from"./vendor-DI8gAUlA.js";class T{constructor(t,e){this.dom=t,this.opt={sceneUrl:"",modelUrl:"",autoRotate:!1,windowSize:!0,...e},this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.model=null,this.init()}init(){this.sceneInit(),this.cameraInit(),this.renderInit(),this.controlsInit(),this.animate(),this.opt.sceneUrl&&this.loadScene(this.opt.sceneUrl),this.opt.modelUrl&&this.loadModel(this.opt.modelUrl),this.opt.windowSize&&window.addEventListener("resize",this.updateRender.bind(this))}sceneInit(){this.scene=new f;const t=new p(16777215,5);this.scene.add(t);const e=new h(16777215,5);e.position.set(1,1,1).normalize(),this.scene.add(e);const i=new h(16777215,.5);i.position.set(-1,-1,-1).normalize(),this.scene.add(i)}cameraInit(){this.camera=new u(70,this.getWidth()/this.getHeight(),.01,2e3),this.camera.position.set(0,0,1.5)}renderInit(){this.renderer=new g({antialias:!0,alpha:!0}),this.renderer.setSize(this.getWidth(),this.getHeight()),this.renderer.setPixelRatio(window.devicePixelRatio),this.dom.appendChild(this.renderer.domElement)}controlsInit(){this.controls=new w(this.camera,this.renderer.domElement),this.controls.autoRotateSpeed=1,this.controls.autoRotate=this.autoRotate,this.controls.enableDamping=!0,this.controls.dampingFactor=.2,this.controls.enableZoom=!0,this.controls.rotateSpeed=.5,this.controlsRotate(this.opt.autoRotate),this.controls.update()}controlsRotate(t){if(this.controls.autoRotate=t||!1,t){let e=null;this.controls.addEventListener("start",()=>{e&&clearTimeout(e),this.controls.autoRotate=!1}),this.controls.addEventListener("end",()=>{e=setTimeout(()=>{this.controls.autoRotate=!0,this.controls.update()},3e3)})}}animate(){requestAnimationFrame(()=>{this.animate()}),this.controls.update(),this.renderer.render(this.scene,this.camera)}loadScene(t){/\.hdr$/i.test(t)?new R().load(t,e=>{e.mapping=d,this.scene.background=e,this.scene.environment=e}):/\.(jpg|jpeg|png|gif|bmp)$/i.test(t)&&new v().load(t,e=>{e.mapping=d,e.wrapS=l,e.wrapT=l,this.scene.background=e,this.scene.environment=e})}loadModel(t){/\.(gltf|glb)$/i.test(t)?new S().load(t,e=>{this.model&&this.scene.remove(this.model);let i=e.scene;this.adjustCamera(i),this.model=i,this.scene.add(this.model)},e=>{},e=>{console.error("模型加载失败:",e)}):/\.fbx$/i.test(t)?new b().load(t,e=>{this.model&&this.scene.remove(this.model),this.adjustCamera(e),this.model=e,this.scene.add(this.model)},e=>{},e=>{console.error("模型加载失败:",e)}):/\.obj$/i.test(t)&&new z().load(t,e=>{this.model&&this.scene.remove(this.model),this.adjustCamera(e),this.model=e,this.scene.add(this.model)},e=>{},e=>{console.error("模型加载失败:",e)})}adjustCamera(t){const e=new L().setFromObject(t),i=e.getSize(new c).length(),o=e.getCenter(new c),s=U.degToRad(this.camera.fov*.5),r=i*.6/Math.tan(s);this.camera.position.set(0,0,r),this.camera.near=i/100,this.camera.far=i*100,this.camera.updateProjectionMatrix(),this.camera.lookAt(o.x,o.y,o.z)}updateRender(){this.camera.aspect=this.getWidth()/this.getHeight(),this.camera.updateProjectionMatrix(),this.renderer.setSize(this.getWidth(),this.getHeight())}getWidth(){return this.opt.windowSize?window.innerWidth:this.dom.offsetWidth}getHeight(){return this.opt.windowSize?window.innerHeight:this.dom.offsetHeight}}const W=x({name:"ThreeView"}),E=Object.assign(W,{props:{sceneUrl:{type:String,required:!0},modelUrl:{type:String},autoRotate:{type:Boolean,default:!1},windowSize:{type:Boolean,default:!0}},setup(a){const t=a,e=m(),i=m();function o(){i.value=new T(e.value,{sceneUrl:t.sceneUrl,modelUrl:t.modelUrl,autoRotate:t.autoRotate,windowSize:t.windowSize})}return C(()=>{o()}),n(()=>t.sceneUrl,s=>{i.value&&i.value.loadScene(s)}),n(()=>t.modelUrl,s=>{i.value&&i.value.loadModel(s)}),n(()=>t.autoRotate,s=>{i.value&&i.value.controlsRotate(s)}),(s,r)=>(M(),j("div",{ref_key:"threeRef",ref:e,class:"threejs-container"},null,512))}});export{E as _};
