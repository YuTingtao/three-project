import{S as c,A as m,P as u,W as p,O as f,R as g,E as l,T as w,f as h,G as R,g as v,F as U,B,V as b,h as n,j as _,w as a,k as x,o as d,c as F}from"./vendor-lSASDyM_.js";class S{constructor(t,e){this.dom=t,this.opt={sceneUrl:"",modelUrl:"",autoRotate:!1,isFullBrowser:!0,...e},this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.model=null,this.init()}init(){this.sceneInit(),this.cameraInit(),this.renderInit(),this.controlsInit(),this.animate(),this.opt.sceneUrl&&this.loadScene(this.opt.sceneUrl),this.opt.modelUrl&&this.loadModel(this.opt.modelUrl),this.opt.isFullBrowser&&window.addEventListener("resize",this.onWindowResize.bind(this))}sceneInit(){this.scene=new c;let t=new m(16777215,1);this.scene.add(t)}cameraInit(){this.camera=new u(70,this.getWidth()/this.getHeight(),.01,2e3),this.camera.position.set(0,0,1.8)}renderInit(){this.renderer=new p({antialias:!0,alpha:!0}),this.renderer.setSize(this.getWidth(),this.getHeight()),this.renderer.setPixelRatio(window.devicePixelRatio),this.dom.appendChild(this.renderer.domElement)}controlsInit(){this.controls=new f(this.camera,this.renderer.domElement),this.controls.autoRotateSpeed=1,this.controls.autoRotate=this.autoRotate,this.controls.enableDamping=!0,this.controls.dampingFactor=.2,this.controls.rotateSpeed=.25,this.controlsRotate(this.opt.autoRotate),this.controls.update()}controlsRotate(t){if(this.controls.autoRotate=t||!1,t){let e=null;this.controls.addEventListener("start",()=>{e&&clearTimeout(e),this.controls.autoRotate=!1}),this.controls.addEventListener("end",()=>{e=setTimeout(()=>{this.controls.autoRotate=!0,this.controls.update()},3e3)})}}animate(){requestAnimationFrame(()=>{this.animate()}),this.controls.update(),this.renderer.render(this.scene,this.camera)}loadScene(t){/\.hdr$/i.test(t)?new g().load(t,e=>{e.mapping=l,this.scene.background=e,this.scene.environment=e}):/\.(jpg|jpeg|png|gif|bmp)$/i.test(t)&&new w().load(t,e=>{e.mapping=l,e.wrapS=h,e.wrapT=h,this.scene.background=e,this.scene.environment=e})}loadModel(t){/\.(gltf|glb)$/i.test(t)?new R().load(t,e=>{this.model&&this.scene.remove(this.model);let s=e.scene;this.adjustModel(s),this.model=s,this.scene.add(this.model)},e=>{},e=>{console.error("模型加载失败:",e)}):/\.obj$/i.test(t)?new v().load(t,e=>{this.model&&this.scene.remove(this.model),this.adjustModel(e),this.model=e,this.scene.add(this.model)},e=>{},e=>{console.error("模型加载失败:",e)}):/\.fbx$/i.test(t)&&new U().load(t,e=>{this.model&&this.scene.remove(this.model),this.adjustModel(e),this.model=e,this.scene.add(this.model)},e=>{},e=>{console.error("模型加载失败:",e)})}adjustModel(t){let e=new B().setFromObject(t),s=new b;e.getSize(s),t.position.y=s.y/12;let o=(s.x+s.y+s.z)/3;this.camera.position.set(0,0,o),this.camera.updateProjectionMatrix()}onWindowResize(){this.camera.aspect=this.getWidth()/this.getHeight(),this.camera.updateProjectionMatrix(),this.renderer.setSize(this.getWidth(),this.getHeight())}getWidth(){return this.opt.isFullBrowser?window.innerWidth:this.dom.offsetWidth}getHeight(){return this.opt.isFullBrowser?window.innerHeight:this.dom.offsetHeight}}const W={__name:"index",props:{sceneUrl:{type:String,required:!0},modelUrl:{type:String},autoRotate:{type:Boolean,default:!1},isFullBrowser:{type:Boolean,default:!0}},setup(r){const t=r,e=n(),s=n();function o(){s.value=new S(e.value,{sceneUrl:t.sceneUrl,modelUrl:t.modelUrl,autoRotate:t.autoRotate,isFullBrowser:t.isFullBrowser})}return _(()=>{o()}),a(()=>t.sceneUrl,i=>{s.value&&s.value.loadScene(i)}),a(()=>t.modelUrl,i=>{s.value&&s.value.loadModel(i)}),a(()=>t.autoRotate,i=>{s.value&&s.value.controlsRotate(i)}),(i,L)=>(d(),x("div",{ref_key:"threeRef",ref:e,class:"threejs-container"},null,512))}},j={__name:"index",setup(r){const t=n("/public/file/scene/mall.hdr"),e=n("/public/file/helmet.glb");return(s,o)=>(d(),F(W,{class:"three-box",sceneUrl:t.value,modelUrl:e.value},null,8,["sceneUrl","modelUrl"]))}};export{j as default};
