import{S as c,A as m,D as r,H as f,P as p,W as u,O as g,R,E as h,T as w,a as d,G as b,F as v,b as L,B as S,V as U,M as x}from"./three-qfolfcsD.js";import{g as C,h as j,f as l,j as B,w as n,k as M,o as T}from"./vendor-CebvytbA.js";class _{constructor(t,e){this.dom=t,this.opt={sceneUrl:"",modelUrl:"",autoRotate:!1,...e},this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.model=null,this.init()}init(){this.initScene(),this.initCamera(),this.initRender(),this.initControls(),this.render(),this.opt.sceneUrl&&this.loadScene(this.opt.sceneUrl),this.opt.modelUrl&&this.loadModel(this.opt.modelUrl),new ResizeObserver(C(e=>{this.updateRender()},100)).observe(this.dom)}initScene(){this.scene=new c;const t=new m(16777215,1);if(this.scene.add(t),!this.opt.sceneUrl){const e=new r(16777215,1);e.position.set(0,1,0).normalize(),this.scene.add(e);const s=new r(16777215,.5);s.position.set(0,-1,0).normalize(),this.scene.add(s);const i=new f(16777215,526368,1);this.scene.add(i)}}initCamera(){this.camera=new p(70,this.dom.offsetWidth/this.dom.offsetHeight,.01,2e3),this.camera.position.set(0,0,1.5)}initRender(){this.renderer=new u({antialias:!0,alpha:!0,logarithmicDepthBuffer:!0}),this.renderer.outputEncoding=void 0,this.renderer.setSize(this.dom.offsetWidth,this.dom.offsetHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.dom.appendChild(this.renderer.domElement)}render(){requestAnimationFrame(()=>{this.render()}),this.controls.update(),this.renderer.render(this.scene,this.camera)}initControls(){this.controls=new g(this.camera,this.renderer.domElement),this.controls.autoRotateSpeed=1,this.controls.autoRotate=this.opt.autoRotate,this.controls.enableDamping=!0,this.controls.dampingFactor=.2,this.controls.enableZoom=!0,this.controls.rotateSpeed=.5,this.controlsRotate(this.opt.autoRotate),this.controls.update()}controlsRotate(t){if(this.controls.autoRotate=t||!1,t){let e=null;this.controls.addEventListener("start",()=>{e&&clearTimeout(e),this.controls.autoRotate=!1}),this.controls.addEventListener("end",()=>{e=setTimeout(()=>{this.controls.autoRotate=!0,this.controls.update()},3e3)})}}loadScene(t){/\.hdr$/i.test(t)?new R().load(t,e=>{e.mapping=h,this.scene.environment=e,this.scene.background=e}):/\.(jpg|jpeg|png|gif|bmp)$/i.test(t)&&new w().load(t,e=>{e.mapping=h,e.wrapS=d,e.wrapT=d,this.scene.background=e,this.scene.environment=e})}loadModel(t){/\.(gltf|glb)$/i.test(t)?new b().load(t,e=>{this.model&&this.scene.remove(this.model);const s=e.scene;this.adjustCamera(s),this.model=s,this.scene.add(this.model)},e=>{},e=>{console.error("模型加载失败:",e)}):/\.fbx$/i.test(t)?new v().load(t,e=>{this.model&&this.scene.remove(this.model),this.adjustCamera(e),this.model=e,this.scene.add(this.model)},e=>{},e=>{console.error("模型加载失败:",e)}):/\.obj$/i.test(t)&&new L().load(t,e=>{this.model&&this.scene.remove(this.model),this.adjustCamera(e),this.model=e,this.scene.add(this.model)},e=>{},e=>{console.error("模型加载失败:",e)})}adjustCamera(t){const s=new S().setFromObject(t).getSize(new U).length(),i=x.degToRad(this.camera.fov*.5),o=s*.5/Math.tan(i);this.camera.position.set(0,0,o),this.camera.updateProjectionMatrix()}updateRender(){this.camera.aspect=this.dom.offsetWidth/this.dom.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.dom.offsetWidth,this.dom.offsetHeight)}}const D=j({name:"ThreeView"}),F=Object.assign(D,{props:{sceneUrl:{type:String,required:!0},modelUrl:{type:String},autoRotate:{type:Boolean,default:!1},debounceDelay:{type:Boolean,default:!1}},setup(a){const t=a,e=l(),s=l();function i(){s.value=new _(e.value,{sceneUrl:t.sceneUrl,modelUrl:t.modelUrl,autoRotate:t.autoRotate,debounceDelay:t.debounceDelay})}return B(()=>{i()}),n(()=>t.sceneUrl,o=>{s.value&&s.value.loadScene(o)}),n(()=>t.modelUrl,o=>{s.value&&s.value.loadModel(o)}),n(()=>t.autoRotate,o=>{s.value&&s.value.controlsRotate(o)}),(o,E)=>(T(),M("div",{ref_key:"threeRef",ref:e,class:"threejs-container"},null,512))}});export{F as _};
